<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <title>VRC Character Updater</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="title">VRC Character Updater</h1>
            <div class="header-actions">
                <span id="environmentIndicator" class="environment-badge" title="Current Environment">Production</span>
                <button id="settingsBtn" class="btn btn-info" title="Settings">âš™ Settings</button>
                <button id="checkUpdatesBtn" class="btn btn-info">Check for Updates</button>
                <button id="viewModeBtn" class="btn btn-info">JSON Mode</button>
                <button id="reloadBtn" class="btn btn-secondary">Reload JSON</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Visual Mode: Scenario Management -->
            <div id="visualMode" class="view-mode">
                <div class="scenarios-header">
                    <h2>Scenarios</h2>
                    <div class="header-controls">
                        <button id="refreshGridBtn" class="btn btn-info">ðŸ”„ Refresh Grid</button>
                        <button id="addRowBtn" class="btn btn-secondary">+ Add Row</button>
                        <button id="addColumnBtn" class="btn btn-secondary">+ Add Column</button>
                        <button id="addScenarioBtn" class="btn btn-success">+ Add Scenario</button>
                    </div>
                </div>
                <div id="scenariosGrid" class="scenarios-grid">
                    <!-- Grid slots will be dynamically added here -->
                </div>
            </div>

            <!-- JSON Mode: Raw JSON Editor -->
            <div id="jsonMode" class="view-mode hidden">
                <textarea id="jsonTextArea" class="json-editor" placeholder="JSON data will appear here..."
                    spellcheck="false"></textarea>
            </div>
        </main>

        <!-- Scenario Modal -->
        <div id="scenarioModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Add Scenario</h3>
                    <button id="closeModalBtn" class="btn-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="scenarioForm">
                        <div class="form-group">
                            <label for="scenarioTitle">Title *</label>
                            <input type="text" id="scenarioTitle" class="form-input" required
                                placeholder="e.g., Having Difficult Conversations">
                        </div>
                        <div class="form-group">
                            <label for="scenarioCharacterId">Character ID *</label>
                            <input type="text" id="scenarioCharacterId" class="form-input" required
                                placeholder="Convai Character ID">
                        </div>
                        <div class="form-group">
                            <label for="scenarioCharacterName">Character Name (optional)</label>
                            <input type="text" id="scenarioCharacterName" class="form-input"
                                placeholder="e.g., Betty, Joshua">
                        </div>
                        <div class="form-group">
                            <label for="scenarioEnvironmentId">Environment ID (optional)</label>
                            <input type="text" id="scenarioEnvironmentId" class="form-input"
                                placeholder="e.g., BDS_Hospital">
                        </div>
                        <div class="form-group">
                            <label for="scenarioEnvironmentName">Environment Name *</label>
                            <input type="text" id="scenarioEnvironmentName" class="form-input" required
                                placeholder="e.g., Hospital - Betty">
                        </div>
                        <div class="form-group">
                            <label for="scenarioGreeting">Greeting *</label>
                            <textarea id="scenarioGreeting" class="form-textarea" rows="3" required
                                placeholder="AI greeting message when experience starts"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="scenarioDescription">Description (optional)</label>
                            <textarea id="scenarioDescription" class="form-textarea" rows="3"
                                placeholder="Brief description of the scenario for display in session history"></textarea>
                        </div>
                        <div class="form-note">
                            <small>Note: Column, Row, and Button Index are auto-generated based on position.</small>
                        </div>
                        <div class="form-actions">
                            <button type="button" id="cancelScenarioBtn" class="btn btn-secondary">Cancel</button>
                            <button type="submit" id="saveScenarioBtn" class="btn btn-success">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Footer with Actions -->
        <footer class="footer">
            <button id="loadFileBtn" class="btn btn-warning">
                ðŸ“‚ Load from File
            </button>
            <button id="saveFileBtn" class="btn btn-secondary">
                ðŸ’¾ Save to File
            </button>
            <button id="uploadBtn" class="btn btn-success">
                â¬† Upload to JSONBin
            </button>
        </footer>

        <!-- Update Modal -->
        <div id="updateModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="updateModalTitle">Update Available</h3>
                    <button id="closeUpdateModalBtn" class="btn-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="updateInfo">
                        <p id="updateStatusMessage" style="margin: 0.5rem 0; font-size: 0.85rem;">Update available for
                            download</p>
                        <p style="margin: 0.5rem 0; font-size: 0.85rem;"><strong>Current Version:</strong> <span
                                id="currentVersion">-</span></p>
                        <p style="margin: 0.5rem 0; font-size: 0.85rem;"><strong>Latest Version:</strong> <span
                                id="latestVersion">-</span></p>
                        <div id="updateReleaseNotes" class="form-note"
                            style="margin-top: 1rem; max-height: 400px; overflow-y: auto; font-size: 0.8rem;"></div>
                    </div>
                    <div id="updateDownloadProgress" class="hidden" style="margin-top: 1rem;">
                        <p id="updateDownloadStatus" style="margin: 0.5rem 0; font-size: 0.85rem;">Downloading update...
                        </p>
                        <div
                            style="background: var(--bg-secondary); border-radius: 4px; padding: 3px; margin-top: 0.5rem;">
                            <div id="updateProgressBar"
                                style="background: var(--primary-color); height: 16px; border-radius: 4px; width: 0%; transition: width 0.3s;">
                            </div>
                        </div>
                        <p id="updateProgressText" style="text-align: center; margin-top: 0.5rem; font-size: 0.8rem;">0%
                        </p>
                    </div>
                    <div id="updateDownloaded" class="hidden" style="margin-top: 1rem;">
                        <p style="font-size: 0.85rem; line-height: 1.4;">The new version has been saved to your
                            Downloads folder. Please close this app and replace the old executable with the new one.</p>
                    </div>
                    <div class="form-actions" style="margin-top: 1.25rem;">
                        <button type="button" id="cancelUpdateBtn" class="btn btn-secondary">Later</button>
                        <button type="button" id="downloadUpdateBtn" class="btn btn-success">Download Update</button>
                        <button type="button" id="openDownloadsBtn" class="btn btn-info hidden">Open Downloads
                            Folder</button>
                        <button type="button" id="installRestartBtn" class="btn btn-primary hidden">Install &
                            Restart</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Settings</h3>
                    <button id="closeSettingsModalBtn" class="btn-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="settingsForm">
                        <div class="form-group">
                            <label for="environmentSelect">Environment *</label>
                            <select id="environmentSelect" class="form-input form-select" required>
                                <option value="">Loading environments...</option>
                            </select>
                            <small class="form-note" style="display: block; margin-top: 0.5rem;">
                                Note: Environment selection does not persist. The app always defaults to Production on
                                startup.
                            </small>
                        </div>
                        <div class="form-actions">
                            <button type="button" id="cancelSettingsBtn" class="btn btn-secondary">Cancel</button>
                            <button type="submit" id="saveSettingsBtn" class="btn btn-success">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Status Message -->
        <div id="statusMessage" class="status-message hidden"></div>
    </div>

    <script src="renderer.js"></script>
</body>

</html>